{"version":3,"sources":["webpack:///./src/lib/components/LifeSpanStorage.react.js"],"names":["LifeSpanStorage","props","key","id","timestampKey","storage","storage_type","sessionStorage","localStorage","data","setItem","setProps","getItem","limit","interval","setInterval","timestamp","now","Date","Number","removeItem","reload","location","JSON","stringify","clearInterval","parse","error","Component","defaultProps","propTypes","PropTypes","string","isRequired","oneOfType","number","array","object","bool","func"],"mappings":"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","file":"33de521-main-wps-hmr.js","sourcesContent":["import PropTypes from 'prop-types';\r\nimport React, {Component} from 'react';\r\n\r\n/**\r\n * ExampleComponent is an example component.\r\n * It takes a property, `label`, and\r\n * displays it.\r\n * It renders an input with the property `value`\r\n * which is editable by the user.\r\n */\r\nexport default class LifeSpanStorage extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.key = this.props.id;\r\n        this.timestampKey = this.props.id + '-timestamp';\r\n        this.storage =\r\n            this.props.storage_type === 'session'\r\n                ? sessionStorage\r\n                : localStorage;\r\n    }\r\n\r\n    /**\r\n     * コンポーネントがマウントされる直前に呼ばれる\r\n     */\r\n    componentDidMount() {\r\n        if (this.props.data || this.props.data == 0) {\r\n            // dataがある場合、セッションストレージに保存\r\n            this.setItem(this.props.data);\r\n        } else {\r\n            // dataが空の場合、セッションストレージから取得する\r\n            this.props.setProps(this.getItem());\r\n        }\r\n\r\n        // 10秒ごとに保存期限をチェック\r\n        if (this.props.limit) {\r\n            this.interval = setInterval(() => {\r\n                const timestamp = this.getItem().timestamp;\r\n                if (timestamp) {\r\n                    // 期限切れの場合削除\r\n                    const now = Date.now();\r\n                    if (Date.now() - Number(timestamp) > this.props.limit) {\r\n                        this.storage.removeItem(this.key);\r\n                        this.storage.removeItem(this.timestampKey);\r\n                        if (this.props.reload) {\r\n                            location.reload();\r\n                        }\r\n                    }\r\n                }\r\n            }, 10000);\r\n        }\r\n        this.getItem();\r\n    }\r\n\r\n    /**\r\n     * コンポーネントが更新される直前に呼ばれる\r\n     */\r\n    componentDidUpdate() {\r\n        if (\r\n            JSON.stringify(this.props.data) !==\r\n            JSON.stringify(this.getItem().data)\r\n        ) {\r\n            this.setItem(this.props.data);\r\n            this.props.setProps(this.getItem());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * コンポーネントが破棄される直前に呼ばれる\r\n     */\r\n    componentWillUnmount() {\r\n        if (this.interval) {\r\n            clearInterval(this.interval);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * セッションストレージにデータを保存\r\n     * @param {*} data\r\n     */\r\n    setItem(data) {\r\n        this.storage.setItem(this.key, JSON.stringify(data));\r\n        this.storage.setItem(this.timestampKey, Date.now());\r\n    }\r\n\r\n    /**\r\n     * セッションストレージからデータを取得\r\n     * @returns\r\n     */\r\n    getItem() {\r\n        let data = this.storage.getItem(this.key);\r\n        try {\r\n            data = JSON.parse(data);\r\n        } catch (error) {}\r\n        return {\r\n            data,\r\n            timestamp: this.storage.getItem(this.timestampKey),\r\n        };\r\n    }\r\n\r\n    render() {\r\n        const {id} = this.props;\r\n        return <div id={id}></div>;\r\n    }\r\n}\r\n\r\nLifeSpanStorage.defaultProps = {\r\n    reload: false,\r\n    storage_type: 'session',\r\n};\r\n\r\nLifeSpanStorage.propTypes = {\r\n    id: PropTypes.string.isRequired,\r\n    data: PropTypes.oneOfType([\r\n        PropTypes.string,\r\n        PropTypes.number,\r\n        PropTypes.array,\r\n        PropTypes.object,\r\n    ]),\r\n    limit: PropTypes.number,\r\n    reload: PropTypes.bool,\r\n    storage_type: PropTypes.oneOfType(['local', 'session']),\r\n    setProps: PropTypes.func,\r\n};\r\n"],"sourceRoot":""}